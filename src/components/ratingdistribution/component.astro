---
import { getCollection } from 'astro:content';
import Chart from './chart.tsx';

const reviews = await getCollection('reviews');

const ratingCounts: { [rating: number]: number } = {
  1: 0,
  2: 0,
  3: 0,
  4: 0,
  5: 0,
};
reviews.forEach((review) => {
  const rating = review.data.rating;
  ratingCounts[rating]++;
});
const chartData = Object.entries(ratingCounts).map(([rating, count]) => ({
  name: rating,
  count: count,
}));

// Generate accessible text description
const accessibleDescription = chartData
  .map((d) => `${d.name} stars: ${d.count} reviews`)
  .join(', ');
---

<div
  role="img"
  aria-label={`Rating distribution chart. ${accessibleDescription}`}
>
  <Chart chartData={chartData} client:load />
</div>
