---
import '@fontsource-variable/public-sans';
import SiteMetadata from '@data/metadata.json';
---
<svg width="1200" height="630" viewBox="0 0 1200 630" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <pattern id="grid" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
      <circle class="dot" cx="2" cy="2" r="1" />
    </pattern>
  </defs>

  <rect width="100%" height="100%" fill="url(#grid)"/>
  <foreignObject x="0" y="0" width="1200" height="600">
    <div id="title" xmlns="http://www.w3.org/1999/xhtml" />
  </foreignObject>
  <text id="description" x="805" y="600">by {SiteMetadata.author.name}</text>
</svg>

<style>
  svg {
    color: #000000;
    fill: #000000;
    font-family: "Public Sans Variable", sans-serif;
    font-feature-settings: "kern" 1, "kern";
    font-kerning: normal;
    font-weight: 400;
    text-anchor: middle;
  }
  .dot {
    fill: #888888;
  }
  #title {
    font-weight: 700;
    font-size: 5rem;
    padding: 1rem;
  }
  #description {
    font-size: 5rem;
  }
</style>

<script>
  function decodeHTMLEntities(text: string) {
		const textarea = document.createElement("textarea");
		textarea.innerHTML = text;
		return textarea.value;
	};

  const params = new URLSearchParams(window.location.search);
	let rawTitle = params.get("title") || 'Untitled';
  if (rawTitle.length >= 120) {
    rawTitle = rawTitle.substring(0, 117) + 'â€¦';
  };
  const title = decodeHTMLEntities(rawTitle);

  const titleElement = document.getElementById("title");
  if (titleElement) {
    titleElement.textContent = title;
  };
</script>